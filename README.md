# CloudHub Log Aggregator for Mule 4

CloudHub Log Aggregator was designed to collect the logs generated by Mule applications deployed to CloudHub. It's based on the CloudHub Log Aggregator for Mule 3. If you have used that version before, you will notice that it doesn't present major changes in its operation nor structure. However, few components and scopes no longer exist in Mule 4 and that required some adjustments.

## Changes between Mule 3 and Mule 4 versions

Some of the changes introduced are:

* ### Structure
   - deleted anypoint-platform-common.xml and centralized all the common components in global.xml
   - removed mule-app.properties and cloudhub.log.aggregator.dev.properties, both were centralized in one .yaml file under /config folder
   - applied secure properties to encrypt user, pwd and environment id properties
   - applied environment based approach for properties files (you need to pass the mule.env argument)
* ### Behavior/Logic
   - Poll component replaced by Scheduler
   - Enricher component replaced by target settings for each component (to export to variables)
   - Batch Execute component replaced by flow-ref to Flow containing Batch job
   - Cache usage 

## Usage
1. Complete the following properties before running the app:
```
#src/main/resources/config/secure/dev.yaml
anypoint:
  platform:
    user: "![YTcZId+H8Z51ecwrCGnYxQ==]"
    password: "![4gGflaq6gWlwhmnJC4XKZg==]"
environment:
   id: "![5D0F35nmDskTbTgzf8i5t0S2C1dUNd/7LIwkF3aTgQok1eTbJE8T24NkYPVMlwqY]"
```
_The shown above is just an example, if you try to run the app with the provided values you will receive an error_

2. Set the following arguments:
* mule.key: this is necessary to encrypt/unencrypt the secure properties. Send the same you used to create the properties in 1
* mule.env: send the env. Initially, the app is only accepting dev as value. 

## Contributing
Pull requests are welcome. For major changes, please open an issue first to discuss what you would like to change.

## Authors
Big shout to David Cisneros (DavoCoder), the creator of the original version for Mule 3.

## Todo list
The following are some of the required improvements for a real-world app:
* Add MUnit suite
* Add error handling strategies
* Plug a log processing strategy in the batch for the logs retrieved (the collector it's only collecting the logs)
* Add multi-environment support
* Add and configure mmp to allow the deployment of the app within CI/CD frameworks